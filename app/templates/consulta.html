{% extends "base.html" %}

{% block title %}Consulta de Pagos{% endblock %}

{% block content %}
<h2>Consulta de Estado de Pago</h2>

<form method="GET" action="{{ url_for('consulta') }}" class="search-form">
    <label for="dni_consulta" style="white-space:nowrap;">DNI o Cliente:</label>
    <input type="text" id="dni_consulta" name="query" required value="{{ request.args.get('query', '') }}" />
    <button type="submit">Buscar</button>
</form>

{% if resultados %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                {% for h in headers %}
                <th>{{ h }}</th>
                {% endfor %}
                <th>ACCIONES</th>
            </tr>
        </thead>
        <tbody>
            {% for fila in resultados %}
            <tr>
                <td>{{ fila[0] }}</td>
                <td>{{ fila[1].strftime('%Y-%m-%d') if fila[1] else '' }}</td>
                {% for celda in fila[2:] %}
                <td>{{ celda if celda is not none else '' }}</td>
            {% endfor %}
                <td class="actions">
                    <a href="{{ url_for('actualizar_pago', id=fila[0], query=request.args.get('query', '')) }}"
                        class="action-icon" title="Actualizar Pago">üîÑ</a>
                    <a href="{{ url_for('editar', id=fila[0], query=request.args.get('query', '')) }}"
                        class="action-icon" title="Editar Registro">‚úèÔ∏è</a>

                    <form action="{{ url_for('eliminar') }}" method="post"
                        onsubmit="return confirm('¬øEst√°s seguro de que deseas eliminar este registro?');">
                        <input type="hidden" name="id" value="{{ fila[0] }}">
                        <input type="hidden" name="query" value="{{ request.args.get('query', '') }}">
                        <button type="hidden" class="action-icon-btn" title="Eliminar Registro">üóëÔ∏è</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% elif resultados is not none %}
<p class="message">No se encontraron registros para tu b√∫squeda.</p>
{% endif %}

{% endblock %}